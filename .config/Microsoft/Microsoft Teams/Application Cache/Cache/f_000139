webpackJsonp([15],{2459:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n(2460),n(2464),n(2473)},2460:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2461),r=n(2463),o=function(){function e(e,t,n,i,r,o){this.loggingService=e,this.$window=t,this.constants=n,this.utilityService=i,this.desktopUtilityService=r,this.eventingService=o,this.logger=e.newLogger(n.experienceContainers.log.prefix+"ExperienceContainerFactory")}return e.$inject=["loggingService","$window","constants","utilityService","desktopUtilityService","eventingService"],e.prototype.generateContainerId=function(){return"experience-container-"+this.utilityService.generateUUID()},e.prototype.create=function(e){this.logger.log("creating experience container");var t=this.generateContainerId(),n=this.desktopUtilityService.isElectron(),o=this.loggingService.findScenario(this.constants.experienceContainers.scenarios.init),a=this.constants.experienceContainers.step.factoryCreate;return o&&o.mark(a,{isElectron:n}),this.loggingService.setContext("ecState",a),n?(this.logger.info("Creating WebView experience container: "+t,e),new r.WebViewExperienceContainer(this.loggingService,t,e,this.$window,this.constants,this.eventingService)):(this.logger.info("Creating IFrame experience container: "+t,e),new i.IframeExperienceContainer(this.loggingService,t,e,this.$window,this.constants))},e}();t.ExperienceContainerFactory=o,angular.module("teamspace.experienceContainerFactory",["teamspace.loggingService","teamspace.constants","teamspace.utilityService","teamspace.desktopUtilityService"]).service("experienceContainerFactory",o)},2461:function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++){t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e}).apply(this,arguments)},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,s)}c((i=i.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){function n(e){return function(t){return i([e,t])}}function i(n){if(r)throw new TypeError("Generator is already executing.");for(;c;)try{if(r=1,o&&(a=2&n[0]?o.return:n[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,o=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(a=c.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){c.label=n[1];break}if(6===n[0]&&c.label<a[1]){c.label=a[1],a=n;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(n);break}a[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],o=0}finally{r=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var r,o,a,s,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(t,"__esModule",{value:!0});var s=n(85),c=function(e){function t(t,n,i,r,o){var a=e.call(this,t.newLogger(o.experienceContainers.log.prefix+"IframeExperienceContainer"),n,i,o,r)||this,s=new URL(i.url);return a.origin=s.origin,a}return i(t,e),t.prototype.createElement=function(e){var t=this,n=s.htmlFactory.createIframe(this.elementId);return n.src=e,n.setAttribute("class","embedded-electron-webview embedded-page-content"),this.$window.addEventListener("message",function(e){var i=e.source,r=e.origin,o=e.data,a=o.channel,s=o.payload;i===n.contentWindow&&r===t.origin&&a===t.constants.multiWindow.channel&&t._handleExperienceContainerEvent(s)}),n},t.prototype.appendTo=function(t){var n=this;return this.element?new Promise(function(i){i(e.prototype.appendTo.call(n,t))}):Promise.reject("unable to mount")},t.prototype.setTimeout=function(e){return void 0===e&&(e=0),o(this,void 0,void 0,function(){return a(this,function(e){return[2,Promise.resolve()]})})},t.prototype._postMessage=function(e){var t=r({},e,{channel:this.constants.multiWindow.channel,metaData:{destination:{channel:e.eventId}}});this.element.contentWindow.postMessage(t,this.origin)},t.prototype.tearDown=function(){},t}(n(293).ExperienceContainer);t.IframeExperienceContainer=c},2462:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this.logger=e,this.handlers=new Map}return e.prototype.publish=function(e){for(var t=this,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];var r=this.handlers.get(e)||[];this.logger.debug("Publishing event "+e+" to "+r.length+" subscribers with following args",n),r.forEach(function(e){try{e.apply(void 0,n)}catch(e){t.logger.warn("Unable to publish event to handler because it threw the following error: "+e)}})},e.prototype.addEventListener=function(e,t){var n=this.handlers.get(e)||[];n.push(t),this.handlers.set(e,n)},e.prototype.removeEventListener=function(e,t){var n=this.handlers.get(e)||[];n=n.filter(function(e){return e!==t}),this.handlers.set(e,n)},e}();t.EventPublisher=i},2463:function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),r=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,s)}c((i=i.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){function n(e){return function(t){return i([e,t])}}function i(n){if(r)throw new TypeError("Generator is already executing.");for(;c;)try{if(r=1,o&&(a=2&n[0]?o.return:n[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,o=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(a=c.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){c.label=n[1];break}if(6===n[0]&&c.label<a[1]){c.label=a[1],a=n;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(n);break}a[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],o=0}finally{r=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var r,o,a,s,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(t,"__esModule",{value:!0});var a=n(85),s=n(293),c=n(207),l=function(e){function t(t,n,i,r,o,a){var s=e.call(this,t.newLogger(o.experienceContainers.log.prefix+"WebViewExperienceContainer"),n,i,o,r)||this;return s.eventingService=a,s._debouncedPublishCrashedEvent=c.default(function(e){return s._publishCrashedEvent(e)},200),s}return i(t,e),t.prototype.createElement=function(e){var t=this;try{var n=a.htmlFactory.createWebView(this.elementId);return n.src=e,n.setAttribute("class","embedded-electron-webview embedded-page-content"),n.setAttribute("webpreferences","nativeWindowOpen=yes, sandbox=yes"),n.setAttribute("allowpopups",""),n.addEventListener("ipc-message",function(e){if(e.channel===t.constants.experienceContainers.channel){var n=e.args&&e.args[0];t._handleExperienceContainerEvent(n)}}),n.addEventListener("crashed",function(){t._handleCrashedEvents("crashed")}),this.$window.electronSafeIpc.on("experience-renderer-crash",function(e,n){t._handleCrashedEvents("experience-renderer-crash",n)}),n.addEventListener("did-fail-load",function(e){t.logger.error("Experience container with Id "+t.elementId+" failed to load. Url="+t.params.url+" Error="+e.errorDescription+" ("+e.errorCode+")"),t.publish("failed-to-load",e)}),n.addEventListener("did-navigate",function(e){var n=e.httpResponseCode,i=t.constants.responseCode;t.logger.info("Experience container with Id "+t.elementId+" did navigate with "+n+". Url="+t.params.url),-1!==n&&n!==i.ok&&t.publish("failed-to-navigate",e)}),n}catch(e){this.logger.error("Experience container with Id "+this.elementId+" loading exception: "+e);var i=this.logger.service.findScenario(this.constants.experienceContainers.scenarios.init);throw i&&i.fail({reason:this.constants.experienceContainers.reason.webViewEcCreateElementFailed}),e}},t.prototype.tearDown=function(){this.$window.electronSafeIpc.removeAllListeners("experience-renderer-crash")},t.prototype.appendTo=function(t){var n=this;return this.element?new Promise(function(i,r){var o={enablePreload:!0,isExperienceRenderer:!0,rendererContext:JSON.stringify(n.params.settings||{})},a=n.$window.setTimeout(function(){n.logger.error("Timed out waiting for IPC response webViewCreationEnabled"),r({reason:n.constants.experienceContainers.reason.timeoutWebViewCreationEnabled})},n.constants.experienceContainers.timers.ipcWebViewCreationEnabledTimeout);n.$window.electronSafeIpc.once(n.constants.events.desktopApp.webViewCreationEnabled,function(){n.logger.info("Received webViewCreationEnabled event, Appending webview element to the page"),n.$window.clearTimeout(a),e.prototype.appendTo.call(n,t).then(i).catch(function(e){n.logger.warn("Failed to append webview element to the page: "+e),r({reason:e})})});try{n.$window.electronSafeIpc.send(n.constants.events.desktopApp.allowWebViewCreate,o)}catch(e){n.logger.error("Failed to send electronSafeIpc - elementId="+n.elementId+": "+e),r({reason:n.constants.experienceContainers.reason.ipcAllowWebViewCreateError,errorCode:e})}}):Promise.reject({reason:this.constants.experienceContainers.reason.webViewEcAppendToNoElement})},t.prototype.setTimeout=function(e){return void 0===e&&(e=0),r(this,void 0,void 0,function(){return o(this,function(t){return[2,this.element.executeJavaScript("\n      // Added by the host to receive a callback when the js queue of this context is empty.\n      (function() {\n        return new Promise((resolve) => {\n          window.setTimeout(() => {\n            resolve();\n          }, "+e+");\n        })\n      })(window);\n    ")]})})},t.prototype._postMessage=function(e){this.element.send(this.constants.experienceContainers.channel,e)},t.prototype._publishCrashedEvent=function(e){this.logger.error("Experience container with Id "+this.elementId+" has crashed"),this.eventingService.$emit(this.constants.events.experienceContainers.crashed,{id:this.elementId});try{this.logger.log("publish crash event: "+JSON.stringify(e))}catch(e){this.logger.log("publish crash event")}this.publish("crashed",e)},t.prototype._handleCrashedEvents=function(e,t){var n=this;if("experience-renderer-crash"===e)return this.$window.setTimeout(function(){n._debouncedPublishCrashedEvent.cancel()},100),this._publishCrashedEvent(t);"crashed"===e&&this._debouncedPublishCrashedEvent(t)},t}(s.ExperienceContainer);t.WebViewExperienceContainer=l},2464:function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++){t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var o=n(85),a=n(2465),s=n(2467),c=n(2469),l=n(111),d=function(e){function t(t,n,i,o,s,l,d,u,h,p,g,v,m,f){var y=e.call(this,t)||this;return y.loggingService=n,y.experienceContainerFactory=i,y.constants=o,y.desktopUtilityService=s,y.settingsService=l,y.experienceContainerFeatureService=d,y.experienceContainerCdlCommunicator=u,y.$window=g,y.isCreatingContainer=!1,y.wrapOnReadyCallback=function(){y.isCreatingContainer=!1,y.onReadyCallback&&y.onReadyCallback()},y.onTearDown=function(e,t){y.logger.warn("Tearing down "+e.experienceContainer.elementId+" because it has "+t.reason+"."),y.settingsService.valueAsBoolean(y.constants.settings.names.enableAutoBRBforERCrashes)&&e.params&&e.params.url&&e.params.url.includes("teams.microsoft.com/")&&"crashed"===t.reason&&0===y.retryManager.recreateAttempts&&y.logger.error("MultiWindow ExperienceRenderer Crashed or Failed to Load, so triggering AutoBRB"),y.remove(e,t),y.shouldRetry(t),y.onTearDownCallback&&y.onTearDownCallback()},y.onShouldRetry=function(e){var t=y.loggingService.findScenario(y.constants.experienceContainers.scenarios.init)||y.loggingService.newScenario(y.constants.experienceContainers.scenarios.retryInit),n=y.constants.experienceContainers.step.onTearDownRecreate;t&&t.mark(n,r({recreateAttempts:y.retryManager.recreateAttempts,reason:e.reason},e.data)),y.loggingService.setContext("ecState",n),y.initInternal(t)},y.onShouldRetryFailure=function(e,t){y.logger.info("Retry failed. We tried to retry "+y.retryManager.recreateAttempts+" times. Retry failure: "+e+". Retry reason: "+t.reason),e===c.RETRY_FAILURES.FAILED&&(y.isCreatingContainer=!1,y.markTearDownScenario(t,y.retryManager.recreateAttempts))},y.mountElement=y.createAndMountElement(),y.serviceWrapper=new a.AngularServiceWrapper(o,v,g,m,f),y.serviceWrapper.initialize(),y.logger=n.newLogger(o.experienceContainers.log.prefix+"ExperienceContainerManager"),y.retryManager=new c.ExperienceContainerRetryManager(o,n,h,p,l),y.initializeOnAppLaunchAndReinit("constructor"),g.addEventListener("unload",function(){y.cleanupOnAppTeardown("shutdown"),n.flush()}),y}return i(t,e),t.$inject=["orchestrationService","loggingService","experienceContainerFactory","constants","desktopUtilityService","settingsService","experienceContainerFeatureService","experienceContainerCdlCommunicator","appStateService","eventingService","$window","$injector","$q","$rootScope"],t.prototype.mtmaTelemetryIdentifier=function(){return"ExperienceContainerManager"},t.prototype.initializeOnAppLaunchAndReinit=function(e){var t=this.loggingService.findScenario(this.constants.experienceContainers.scenarios.init);this.initInternal(t)},t.prototype.cleanupOnAppTeardown=function(e){this.container&&this.remove(this.container,{reason:e}),this.markTearDownScenario({reason:e},this.retryManager.recreateAttempts),this.container=void 0,this.retryManager.reset(),"shutdown"===e&&(this.onReadyCallback=void 0),this.isCreatingContainer=!1,this.onTearDownCallback=void 0},t.prototype.reload=function(){this.cleanupOnAppTeardown("reloaded");var e=this.loggingService.findScenario(this.constants.experienceContainers.scenarios.init)||this.loggingService.newScenario(this.constants.experienceContainers.scenarios.retryInit);this.initInternal(e)},Object.defineProperty(t.prototype,"isReady",{get:function(){var e=this.getContainerEntry();return!(!e||!e.isReady)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"retryState",{get:function(){return this.retryManager.retryState},enumerable:!0,configurable:!0}),t.prototype.setOnReadyCallback=function(e){this.onReadyCallback=e;var t=this.getContainerEntry();t?t.onReady(this.wrapOnReadyCallback):this.logger.warn("Registration for onReady callback arrived when container entry is undefined")},t.prototype.setOnTearDownCallback=function(e){this.onTearDownCallback=e},t.prototype.nudge=function(){if(this.logger.info("Received a nudge to recreate the experience container"),this.isCreatingContainer)this.logger.info("Ignoring nudge request as we are already creating a container.");else{var e=this.getContainerEntry();e||(this.retryManager.reset(),this.shouldRetry({reason:"nudge"})),(e=this.getContainerEntry())||this.logger.error("The nudge attempt failed to recreate the experience container.")}},t.prototype.collectLogs=function(){var e=this.getContainerEntry();return e?e.collectLogs():Promise.resolve([])},t.prototype.collectLeaks=function(){var e=this.getContainerEntry();return e?e.collectLeaks():Promise.resolve({})},t.prototype.getWindowEntityTypeStats=function(){var e=this.getContainerEntry();return e?e.getWindowEntityTypeStats():Promise.resolve({})},t.prototype.shouldShowChatNotification=function(e){var t=this.getContainerEntry();return t?t.shouldShowChatNotification(e):Promise.resolve({shouldShowChatNotification:!0,windowId:void 0})},t.prototype.getHostSettings=function(){return this.serviceWrapper.getHostSettings()},t.prototype.initInternal=function(e){if(this.isEnabled())try{this.isCreatingContainer=!0;var t=l.getExperienceContainerUrlSetting(this.constants,this.settingsService);this.logger.info("Registering experience container with URL: {0}",t),this.register(this.prepareContainerUrl(t));var n=this.constants.experienceContainers.step.appLaunchRegister;e&&e.mark(n),this.loggingService.setContext("ecState",n)}catch(t){this.logger.error("Failed to initialize container",t);i=this.constants.experienceContainers.reason.appLaunchFailed;e&&e.fail({reason:i}),this.loggingService.setContext("ecState",i),this.isCreatingContainer=!1}else{var i=this.constants.experienceContainers.reason.notEnabledDuringAppLaunch;e&&e.fail({reason:i}),this.loggingService.setContext("ecState",i)}},t.prototype.isEnabled=function(){return this.experienceContainerFeatureService.isHybridAppExperienceContainerEnabled()||this.experienceContainerFeatureService.isMultiWindowExperienceContainerEnabled()},t.prototype.prepareContainerUrl=function(e){var t=this.desktopUtilityService.isElectron()?"electron":"web",n=new URL(e);n.pathname.endsWith("/")||(this.logger.info("Appending trailing / to url"),n.pathname+="/"),n.searchParams.append("agent",t);var i=this.$window.desktopSettings&&this.$window.desktopSettings.experienceRendererBuildContainer;return i?n.searchParams.append("container",i):n.searchParams.append("version",this.getVersion()),n.href},t.prototype.getDefaultContainerSettings=function(e){return{windowId:"northstarCore",hostSettings:this.serviceWrapper.getHostSettings(),perfMarkers:{windowCreateTimeFromMainRenderer:Date.now()},loadUrl:e}},t.prototype.getVersion=function(){return this.settingsService.getOrbitalVersion(this.constants.settings.orbitals.multiWindow)},t.prototype.register=function(e){try{var t={url:e,settings:this.getDefaultContainerSettings(e)};this.container=this.createContainerEntry(t),this.logger.info("Adding EC '"+this.container.experienceContainer.elementId+"'"),this.container.outerWrap&&this.mountElement.appendChild(this.container.outerWrap),this.container.onReady(this.wrapOnReadyCallback)}catch(t){throw this.logger.error("Failed to create container entry",t,e),t}},t.prototype.getContainerEntry=function(){return this.isEnabled()&&this.container},t.prototype.get=function(){var e=this.getContainerEntry();return e&&e.experienceContainer},t.prototype.getUiHandle=function(){var e=this.getContainerEntry();return e&&e.outerWrap},t.prototype.createContainerEntry=function(e){return this.markCreateNewScenario(),new s.ContainerEntry(e,this.experienceContainerFactory,this.loggingService,this.serviceWrapper,this.experienceContainerCdlCommunicator,this.onTearDown,this.constants,this.$window,this.logger,this.settingsService)},t.prototype.remove=function(e,t){this.logger.info("Removing EC '"+e.experienceContainer.elementId+"' with reason='"+t.reason+"'"),e.outerWrap&&this.mountElement.removeChild(e.outerWrap),this.experienceContainerCdlCommunicator&&this.experienceContainerCdlCommunicator.teardown(e.experienceContainer.elementId),this.container=void 0},t.prototype.shouldRetry=function(e){var t=this;this.retryManager.shouldRetry(e).then(function(){return t.onShouldRetry(e)}).catch(function(n){return t.onShouldRetryFailure(n,e)})},t.prototype.markCreateNewScenario=function(){var e=this.constants.experienceContainers.scenarios.createNew;this.loggingService.newScenario(e).stop()},t.prototype.markTearDownScenario=function(e,t){var n=e.data,i=e.reason,o=this.loggingService.findScenario(this.constants.experienceContainers.scenarios.init)||this.loggingService.findScenario(this.constants.experienceContainers.scenarios.retryInit)||this.loggingService.newScenario(this.constants.experienceContainers.scenarios.tearDown);s.isTearDownDueToFailure(e)?o&&o.fail(r({reason:i,errorCode:i,retryAttempt:t},n)):o&&o.stop(r({reason:i,retryAttempt:t},n)),this.loggingService.setContext("ecState",i)},t.prototype.createAndMountElement=function(){var e=o.htmlFactory.createDiv("ExperienceContainerManagerMountElement");return e.setAttribute("class","experience-container-root"),document.body.appendChild(e),e},t}(teamspace.services.MTMABase);t.ExperienceContainerManager=d,angular.module("teamspace.experienceContainerManager",["teamspace.orchestrationService","teamspace.loggingService","teamspace.experienceContainerFactory","teamspace.constants","teamspace.desktopUtilityService","teamspace.settingsService","teamspace.experienceContainerFeatureService","teamspace.experienceContainerCdlCommunicator","teamspace.appState","teamspace.eventingService"]).service("experienceContainerManager",d)},2465:function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++){t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e}).apply(this,arguments)},r=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,s)}c((i=i.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){function n(e){return function(t){return i([e,t])}}function i(n){if(r)throw new TypeError("Generator is already executing.");for(;c;)try{if(r=1,o&&(a=2&n[0]?o.return:n[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,o=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(a=c.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){c.label=n[1];break}if(6===n[0]&&c.label<a[1]){c.label=a[1],a=n;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(n);break}a[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],o=0}finally{r=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var r,o,a,s,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(t,"__esModule",{value:!0});var a=teamspace.services,s=n(37),c=n(2466),l=function(){function e(e,t,n,i,r){this.constants=e,this.$injector=t,this.$window=n,this.$q=i,this.$rootScope=r,this.maxPromiseDelayMs=2e4}return e.prototype.initialize=function(){this.eventingService=this.$injector.get("eventingService"),this.authenticationService=this.$injector.get("authenticationService"),this.navigationService=this.$injector.get("navigationService"),this.myUserPreferencesStore=this.$injector.get("myUserPreferencesStore"),this.utilityService=this.$injector.get("utilityService"),this.brbFeedbackService=this.$injector.get("brbV2FeedbackService"),this.channelService=this.$injector.get("channelService"),this.dialogService=this.$injector.get("dialogService"),this.teamActionDialogUtilityService=this.$injector.get("teamActionDialogUtilityService"),this.settingsService=this.$injector.get("settingsService"),this.localizationService=this.$injector.get("localizationService"),this.appStateService=this.$injector.get("appStateService"),this.messageHubService=this.$injector.get("messageHubService"),this.geoRoutingService=this.$injector.get("geoRoutingService"),this.immersiveReaderService=this.$injector.get("immersiveReaderService"),this.loggingService=this.$injector.get("loggingService"),this.sxConfig=this.$injector.get("sxConfig"),this.analyticsService=this.$injector.get("analyticsService"),this.conversationsService=this.$injector.get("conversationsService"),this.meetingNotesService=this.$injector.get("meetingNotesService"),this.callingSupportService=this.$injector.get("callingSupportService"),this.broadcastJoinService=this.$injector.get("broadcastJoinService"),this.screenSharingControlService=this.$injector.get("screenSharingControlService"),this.identityService=this.$injector.get("identityService"),this.logger=this.loggingService.newLogger(this.constants.experienceContainers.log.prefix+"ServiceWrapper"),this.workerDataLayerClientHandler=this.$injector.get("workerDataLayerClientHandler"),this.deepLinkService=this.$injector.get("deepLinkService"),this.aggregatedSettingsStore=this.$injector.get("aggregatedSettingsStore"),this.hybridContentRouteListener=this.$injector.get("hybridContentRouteListener"),this.callingMultiWindowService=this.$injector.get("callingMultiWindowService"),this.hybridContentVisibilityManager=this.$injector.get("hybridContentVisibilityManager"),this.desktopUtilityService=this.$injector.get("desktopUtilityService"),this.taskModuleLaunchService=this.$injector.get("taskModuleLaunchService"),this.experienceContainerFeatureService=this.$injector.get("experienceContainerFeatureService"),this.shortcutService=this.$injector.get("shortcutService")},e.prototype.emitMessage=function(e,t){this.eventingService.$emit(e,t)},e.prototype.sendScreenSharingControlMessage=function(e){this.screenSharingControlService.postScreenSharingControlMessage(e)},e.prototype.sendBiTelemetry=function(e,t){var n={action:{gesture:void 0,outcome:teamspace.shared.AttributeHelper.tryGetEnumString(teamspace.components.PanelActionOutcome.popOutToNewWindow,teamspace.components.PanelActionOutcome),scenario:teamspace.components.PanelActionScenario.popOutChat,scenarioType:teamspace.components.PanelActionScenarioType.clickButton},panel:{type:e,uri:void 0,uriParams:void 0,viewId:t}};this.analyticsService.sendPanelAction(n)},e.prototype.getAggregatedSettings=function(){var e=this.aggregatedSettingsStore.getSettings(),t=this.$q.resolve(e);return this.utilityService.getPromiseWithTimeout(t,this.maxPromiseDelayMs,void 0,"Get aggregated settings reached maximum timeout.")},e.prototype.getAadToken=function(e,t,n){return this.utilityService.getPromiseWithTimeout(this.authenticationService.getAuthTokens([e],t?[t]:void 0),n||this.maxPromiseDelayMs,void 0,"Webclient Auth request reached maximum timeout - "+(n||this.maxPromiseDelayMs)+".")},e.prototype.getAadTokenObject=function(e){var t=e.resource,n=e.claim,i=e.silent,r=e.forceTokenRenew,o=e.timeout,a=e.correlationId;return this.utilityService.getPromiseWithTimeout(this.authenticationService.getAuthToken(t,n,i,r,a),o||this.maxPromiseDelayMs,void 0,"Webclient Auth request reached maximum timeout - "+(o||this.maxPromiseDelayMs)+".")},e.prototype.getSkypeToken=function(e){var t=this;return this.utilityService.getPromiseWithTimeout(this.authenticationService.getSkypeTokens().then(function(e){return{token:e,regionGtms:t.geoRoutingService.getCurrentRoutingTable()}}),e||this.maxPromiseDelayMs,void 0,"Webclient Auth request reached maximum timeout - "+(e||this.maxPromiseDelayMs)+".")},e.prototype.getAuthUser=function(e){return this.utilityService.getPromiseWithTimeout(this.authenticationService.getUserInformation(),e||this.maxPromiseDelayMs,void 0,"Webclient Auth request reached maximum timeout - "+(e||this.maxPromiseDelayMs)+".")},e.prototype.clearAadCache=function(e){e&&this.authenticationService.clearAdalCache(e)},e.prototype.handleCentralDataLayerRequest=function(e){return this.messageHubService.universalCommunicator.handleRequest(e)},e.prototype.generateUuid=function(){return this.utilityService.generateUUID()},e.prototype.getHostSettings=function(){var e=this.settingsService.getSettings(),t=!e.runningscenariotests&&void 0;return{default:i({},e,{isLPCEnabled:t}),hostSettings:{keyboardLayoutLanguage:this.localizationService.getKeyboardLayout(),localeCode:this.settingsService.getCurrentLocale(),theme:this.settingsService.getActiveTheme(),performanceMode:this.settingsService.getPerformanceMode(),appState:this.appStateService.current,createdTime:Date.now(),enableSyncEngine:this.workerDataLayerClientHandler.enabled,canGetSkypeToken:"mainRenderer",canGetAadToken:"mainRenderer",hostAppWebVersion:this.settingsService.getVersion().clientVersion,desktopAppVersion:this.desktopUtilityService.getDesktopVersion(),cdlSharedWorkerUrl:window.cdlSharedWorkerJsUrl,enableOsDateTimeFormatting:this.settingsService.valueAsBoolean(this.constants.settings.names.enableOsDateTimeFormatting),enableOsDateTimeFormattingTelemetry:this.settingsService.valueAsBoolean(this.constants.settings.names.enableOsDateTimeFormattingTelemetry),isRaiseHandsEnabled:this.callingSupportService.isRaiseHandsEnabledForMultiWindow(),isAttendeeRestrictionsEnabled:this.callingSupportService.isAttendeeRestrictionsEnabled(),isAttendeeRestrictionsUpdatesEnabled:this.callingSupportService.isAttendeeRestrictionsUpdatesEnabled(),isRequestToSpeakEnabled:this.callingSupportService.isRequestToSpeakEnabled(),isBufferSharingEnabled:this.settingsService.valueAsBoolean(this.constants.settings.names.callingEnableBufferSharing),isFirstFrameRenderEnabled:this.settingsService.valueAsBoolean(this.constants.settings.names.callingEnableFirstFrameRender),enablePreJoinV2:this.settingsService.valueAsBoolean(this.constants.settings.names.enablePreJoinV2),enableMainWindowPolicyFetch:this.settingsService.valueAsBoolean(this.constants.settings.names.enableMainWindowPolicyFetch),enableCallingIntentEvents:this.settingsService.valueAsBoolean(this.constants.settings.names.enableCallingIntentEvents),enableTeacherPresentInMeetingRestriction:this.settingsService.valueAsBoolean(this.constants.settings.names.enableTeacherPresentInMeetingRestriction),isHybridCallsAppWithContactsEnabled:this.settingsService.valueAsBoolean(this.constants.settings.names.enableHybridCallsAppWithContacts),isChatHybridArchitectureEnabled:this.experienceContainerFeatureService.isChatHybridAppExperienceContainerEnabled(),isCallingMultiWindowEnabled:this.callingMultiWindowService.isCallingMultiWindowEnabled(),isCallingMWRolloutPhases:this.callingMultiWindowService.isCallingMWInPhasedRollout(),enableCallQueueIntentIdTeamsCallIdChangedEvent:this.settingsService.valueAsBoolean(this.constants.settings.names.enableCallQueueIntentIdTeamsCallIdChangedEvent),enableRecordingAndTranscribingInCallsAppV2:this.settingsService.valueAsBoolean(this.constants.settings.names.enableRecordingAndTranscribingInCallsAppV2),userType:this.settingsService.valueFor(this.constants.settings.names.userType)||null,enableBetterTogetherDeviceMoveCall:this.settingsService.valueAsBoolean(this.constants.settings.names.enableBetterTogetherDeviceMoveCall),enableCacheBustingQSPRetry:this.settingsService.valueAsBoolean(this.constants.settings.names.enableCacheBustingQSPRetry),systemManufacturer:this.desktopUtilityService.getSytemManufacturer(),systemProductName:this.desktopUtilityService.getSystemProductName()},dataLayerSettings:i({},this.messageHubService&&this.messageHubService.getSupportedOperations?this.messageHubService.getSupportedOperations():{}),bootstrapData:this.getBootstrapData()}},e.prototype.triggerAutoBrb=function(e){if(this.settingsService.valueAsBoolean(this.constants.settings.names.enableMWAutoBrb))try{this.brbFeedbackService.sendFeedbackToBrbV2(!0,{category:this.constants.feedback.categories.other,title:"[AutoBRB] "+e,description:"[AutoBRB] "+e,allowScreenshots:!1,includeBackgroundBlurImages:!1,piiSafeLogsOnly:!1})}catch(e){this.logger.warn("triggerAutoBrb failed with "+e)}},e.prototype.dispatchEventToMainWindow=function(e){switch(e){case"click":case"mousemove":var t=new MouseEvent(e),n=this.$window.document.activeElement;Object.defineProperty(t,"target",{value:n,enumerable:!0}),this.$window.document.dispatchEvent(t)}},e.prototype.navigateMainWindowWithEntityCommand=function(e,t){return r(this,void 0,void 0,function(){var n,i,r,a,s,l,d,u,h,p,g,v,m,f,y,C,S,w,b,E,R,x,T,I,A,k,M,O,W,L,P,D,F=this;return o(this,function(o){switch(o.label){case 0:return n="experience-container-entity-command",i=e.entity,r=i.type,a=i.action,s=i.id,l=i.linkedEntity,d=e.entityOptions,u=e.command,h=u.stateTransition,p="navigateMainWindowWithEntityCommand: ",this.externalDialogHandler||(this.externalDialogHandler=new c.ExternalDialogHandler(this.dialogService,this.logger,this.$q,t)),"extensions"!==r||"view"!==a?[3,1]:("organization"===s&&this.navigateToOrgChart(l,p),[3,16]);case 1:return"transcripttab"!==r?[3,2]:(this.navigateToChatTranscript(e,p),[3,16]);case 2:return"channels"===r&&"view"===a&&s?d?(g=d,v=g.dateTimeSent,m=g.messageId,f=g.parentMessageId,y=void 0===f?m:f,C=s,S="Team",w="Channel",this.getTeamAndChannel(s).then(function(e){e&&e.team&&(S=e.team.displayName),e&&e.channel&&(w=e.channel.displayName),F.navigationService.navigateToMessage(F.$rootScope,v,C,m,y,m,n,S,w,null,F.constants.appId.search,null)}),[3,16]):[2]:[3,3];case 3:return"schedulingform"!==r||"create"!==a?[3,4]:d?(b=d.conversationId,this.navigationService.navigateToCalendarScheduleForm("CreateUpdateMeeting",{navCtx:n,conversationId:b}),[3,16]):[2];case 4:return"chats"!==r||"view"!==a?[3,6]:(E=d&&d.messageId,[4,E?this.navigationService.navigateToMessage(this.$rootScope,(new Date).toString(),s,E,E,E,n,null,null,null,this.constants.appId.search):this.navigationService.navigateToChat(s,n)]);case 5:return P=o.sent(),this.logger.info(p+"View Chat: "+s+", navigationResult: "+P),[3,16];case 6:return"chats"!==r||"create"!==a?[3,7]:(R=s.replace(/[\[\]\"]/g,""),this.navigationService.navigateToUserChat(R,"reactSearchPeopleNavigation"),[3,16]);case 7:return"brbfeedbackdialog"!==r||"view"!==a?[3,9]:[4,this.brbFeedbackService.openDialog(void 0,void 0,void 0,void 0,void 0,!0)];case 8:return o.sent(),this.logger.info(p+"BRB Feedback"),[3,16];case 9:return"extend"!==h?[3,11]:[4,this.handleExtensions(e,p)];case 10:return o.sent(),[3,16];case 11:return"platformapps"!==r||"list"!==a?[3,13]:[4,this.navigationService.navigateToAppsView()];case 12:return o.sent(),this.logger.info(p+"Navigation to Apps View is complete."),[3,16];case 13:return"file"!==r||"view"!==a?[3,15]:(x=e.entityOptions,T=x.fileId,I=x.fileType,A=x.objectUrl,k=x.serviceName,M=x.shareId,O=x.shareUrl,W={baseUrl:"",fileId:T,fileType:I,objectUrl:A,serviceName:k,shareId:M,shareUrl:O,viewerAction:this.constants.files.fileActions.viewer.view},L={documentViewerParams:_.pickBy(W,_.identity),viewerState:this.constants.states.appDocumentViewer},[4,this.navigationService.navigateToFileViewer(L)]);case 14:return P=o.sent(),this.logger.info(p+"View file: "+T+", navigationResult: "+P),[3,16];case 15:return this.logger.warn(p+" Called with an entityCommand, but did not match any results entity "+e.entity),[2];case 16:return(D=this.$window.electronSafeIpc)?D.send("windowFocus"):this.$window.focus(),[2]}})})},e.prototype.navigateToOrgChart=function(e,t){return r(this,void 0,void 0,function(){var n,i,r;return o(this,function(o){switch(o.label){case 0:n=e.id;try{i=JSON.parse(n||"[]")[0]}catch(e){return this.logger.error(t+"Failed to parse org chart mri: "+n),[2]}return[4,this.navigationService.navigateToPerson(i,this.constants.peopleTab.panes.organization,!1)];case 1:return r=o.sent(),this.logger.info(t+"Org Chart mri: "+i+", navigationResult: "+r),[2]}})})},e.prototype.navigateToChatTranscript=function(e,t){return r(this,void 0,void 0,function(){var n,i,r;return o(this,function(o){switch(o.label){case 0:return n=e.entity.id,i=e.entityOptions,[4,this.navigationService.navigateToChatTranscript(i.conversationId,n)];case 1:return r=o.sent(),this.logger.info(t+"To chat transcript view (conversation: "+e+"), navigationResult: "+r),[2]}})})},e.prototype.navigateHybridContentRoute=function(e){return r(this,void 0,void 0,function(){var t,n,r,s,c,l,d,u,h,p,g,v,m,f,y,C;return o(this,function(o){switch(o.label){case 0:if(t="navigateHybridContentRoute: ",n="experience-container-entity-command",r=e.entity,s=r.type,c=r.action,l=r.id,d=e.command,u=d.correlation,h=d.visibilityState,p=e.entityOptions,"blank"===s)return[2,Promise.resolve()];if("galleryImages"===s)return"show"===h?this.hybridContentVisibilityManager.showElement(a.LayoutChangeType.FullscreenStart):"hide"===h&&this.hybridContentVisibilityManager.showElement(a.LayoutChangeType.FullscreenStop),[2,Promise.resolve()];if(void 0===(g=this.hybridContentRouteListener.getRouteForSentCommand(u.id)))return[3,5];o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.navigationService.navigatePromise(this.$rootScope,g.toState.name,i({},g.toParams,{commandCorrelationId:u.id}),!0)];case 2:return f=o.sent(),this.logger.info(t+" Navigating to route sent by hybridcontentroutelistener, navigationResult: "+f),[3,4];case 3:return v=o.sent(),(m=this.loggingService.findScenarioByNameAndId(this.constants.experienceContainers.scenarios.hybridRoute,u.id))&&m.fail({reason:"NavigationFailed"}),[3,4];case 4:return[3,9];case 5:return"chats"===s&&"view"===c&&l?[4,this.navigationService.navigateToChat(l,n)]:[3,7];case 6:return f=o.sent(),this.logger.info(t+" Internal command Chat: "+l+", navigationResult: "+f),[3,9];case 7:return"search"!==s||"view"!==c?[3,9]:(y=p.searchQuery,C=p,[4,this.navigationService.navigateToSearchPageState(y,null,null,null,null,null,C,n)]);case 8:o.sent(),this.logger.info(t+" Navigation to search page complete."),o.label=9;case 9:return[2,this.hybridContentVisibilityManager.showElement()]}})})},e.prototype.onHybridContentReadyToRender=function(e){"galleryImages"===e.entity.type&&this.hybridContentVisibilityManager.onHybridContentReadyToRender()},e.prototype.navigateMainWindow=function(e,t){var n=this,i=!0;switch(e){case a.OpenHandler.ImmersiveReader:this.immersiveReaderService.launchImmersiveReaderRemote(t.conversationId,t.messageId,t.setFocusOnClose).catch(function(e){n.logger.error("Unable to launch immersive reader from remote, reason: "+e)});break;case a.OpenHandler.MeetingNotes:var r,o=t.conversationId,s=t.messageId,c=t.pageId,l=t.sectionId,d=t.scenarioId,u=this.conversationsService.getConversation(o).isMeetingConversation(),h=d&&this.loggingService.findScenario(d);r=null==c||null==l?this.meetingNotesService.getMeetingNotesLink(u,o,s):Promise.resolve({pageId:c,sectionId:l}),this.meetingNotesService.findMeetingNotesTab(o).then(function(e){return r.then(function(t){var i=t.pageId,r=t.sectionId;return n.navigationService.navigateToMeetingNotes(n.constants.navContext.multiWindow,o,u,i,r,e&&e.id)})}).then(function(){return h&&h.stop()}).catch(function(){return h&&h.fail({reason:"Navigation to "+(u?"private":"channel")+" notes ("+c+", "+l+") failed"})});break;case a.OpenHandler.DeepLink:this.deepLinkService.executeDeepLink(t.url);break;case a.OpenHandler.JoinBroadcastAsAttendee:var p={tenantId:t.tenantId,organizerId:t.organizerId,threadId:t.threadId,messageId:s=t.messageId,userRoleOverride:teamspace.services.BroadcastParticipantRole.Attendee};this.broadcastJoinService.joinBroadcastPlayback(p);break;case a.OpenHandler.Transcript:var g=t.transcriptId,v=t.meetingOrganizerId,m=t.meetingTenantId,f=t.iCalUid,y=t.conversationId;this.navigationService.navigateToCalendarTranscriptTab(g,v,m,f,y);break;default:i=!1}if(i){var C=this.$window.electronSafeIpc;C?C.send("windowFocus"):this.$window.focus()}return i},e.prototype.sendHybridViewportRenderingEvents=function(e,t,n){e===s.CommandEvent.RenderStarted&&this.eventingService.$emit(this.constants.events.orchestration.resumeDeferredStages),t&&t.entity&&t.entity.type&&"chats"===t.entity.type&&(e===s.CommandEvent.Rendered||!1===n&&e===s.CommandEvent.RenderStarted)&&(this.eventingService.$emit(this.constants.events.messages.messageListRenderStateChanged,{state:teamspace.components.MessageListRenderState.Rendered,conversationId:t.entity.id}),this.eventingService.$emit(this.constants.events.messages.messageListRendered),this.eventingService.$emit(this.constants.events.messages.messageListRenderStateChanged,{state:teamspace.components.MessageListRenderState.RenderedFully,conversationId:t.entity.id}))},e.prototype.handleUnhandledShortcut=function(e){var t=new KeyboardEvent(e.payload.type,e.payload);switch(e.payload.type){case"keydown":if(this.shortcutService.onHandleKeyDown(t)){var n=this.$window.electronSafeIpc;n?n.send("windowFocus"):this.$window.focus()}break;case"keyup":this.shortcutService.onHandleKeyUp(t)}},e.prototype.handleApplicationStateChange=function(e){if(void 0!==e&&(e===a.ApplicationState.Interactive||e===a.ApplicationState.InCall)){if(this.appStateService.isDesktopApp&&this.appStateService.hasMachineState(a.MachineState.MachineLocked))return;this.emitMessage("IdleEnd")}},e.prototype.getTeam=function(e){var t=this;return this.channelService.resolveTeamAndChannel(e).then(function(n){return n.team.objectId===e?t.$q.resolve(n.team):(t.logger.error("Failed to fetch team "+e),t.$q.reject())})},e.prototype.getTeamAndChannel=function(e){return this.channelService.resolveTeamAndChannel(e).then(function(e){return e})},e.prototype.getBootstrapData=function(){var e=this.geoRoutingService.getCurrentRoutingTable(),t=e&&e.regionName,n=this.sxConfig.getCurrentSkypeMri(),i=this.myUserPreferencesStore.getUserPreferences(),r={isFreemium:this.identityService.isFreemiumTenant()};return this.logger.info("getBootstrapData() returning currentUserMri="+n),{readReceiptUserPreference:i.readReceiptsEnabled,controllerConnectedServicesEnabled:i.controllerConnectedServicesEnabled,theme:this.settingsService.getActiveTheme(),userId:n,region:t,regionGtms:e,licenseDetails:r}},e.prototype.getExtensionKey=function(e){var t=e.entity;return t.type+"_"+t.action},e.prototype.setExtensionInMap=function(e,t){var n=this,i=e.entity,r=i.type,o=i.id,a=i.action,s=e.entityOptions,c=this.getExtensionKey(e),l=null;if("view"===a)switch(r){case"teampicture":l={name:this.constants.dialogs.changeTeamPicture,openArgsResolver:function(){return n.getTeam(o).then(function(e){return n.logger.info(t+"Edit team picture: "+o),{team:e}})}};break;case"teamjoincode":l={name:this.constants.dialogs.presentTeamJoinCode,openArgsResolver:function(){return n.getTeam(o).then(function(e){var i=s;return n.logger.info(t+"Show team join code : "+o),{team:e,teamJoinCode:i.teamJoinCode}})}};break;case"teamrenewal":l={name:this.constants.dialogs.presentTeamJoinCode,openArgsResolver:function(){return n.getTeam(o).then(function(e){var i=s;return n.logger.info(t+"Show Team renewal confirmation: "+o),n.teamActionDialogUtilityService.getRenewTeamDialogData(i.expiryTime,e,[])})}}}else if("create"===a)switch(r){case"platformapp":l={name:this.constants.lazyDialogs.addAppNew,openArgsResolver:function(){return n.getTeam(o).then(function(e){var t=s;return n.logger.info("App installation flow invoked via commanding for appId: "+t.appId),{entryPoint:t.entryPoint,appId:t.appId}})},lazyLoadModule:this.constants.lazyModules.extensibilityDialogs}}if(!l)throw this.logger.error("Received extend command but extension not supported for "+e.entity.id),new Error("Unsupported extend command");return this.extensionMap.set(c,l),l},e.prototype.handleExtensions=function(e,t){var n=this,i=e.command.visibilityState,r=e.entity.type;if(this.extensionMap||(this.extensionMap=new Map),"hide"===i){var o=this.getExtensionKey(e),a=this.extensionMap.get(o);if(!a)throw this.logger.error("Received hide command but extension not in map "+o),new Error("Hide command for non-existing extension");var s=a.name;return Promise.resolve(this.externalDialogHandler.closeDialog(s))}if("taskmodule"!==r){var c=this.setExtensionInMap(e,t),l=c.name,d=c.openArgsResolver,u=c.lazyLoadModule;return d().then(function(e){n.externalDialogHandler.open(l,e,u)})}this.logger.info(t+"launching angular task module"),this.taskModuleLaunchService.launchTaskModuleByEntityCommand(e,this.externalDialogHandler)},e}();t.AngularServiceWrapper=l},2466:function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++){t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=n(37),o=function(){function e(e,t,n,i){this.dialogService=e,this.logger=t,this.$q=n,this.postMessageHandler=i}return e.prototype.open=function(e,t,n){var o=this;void 0===t&&(t={}),this.openResultPromise&&this.openResultPromise.then(function(t){o.logger.warn("Closing dialog id "+t.id+" due to new dialog open request for "+e+"."),t.close()});var a=function(){o.postMessageHandler({eventId:r.ChildWindowEventRequest.ExtendedEntityContainerState,payload:{containerState:teamspace.services.ExtendedContainerState.Confirmed}})},s=function(e){return o.postMessageHandler({eventId:r.ChildWindowEventRequest.ExtendedEntityContainerState,payload:{containerState:e}})};return this.openResultPromise=n?this.dialogService.openLazyDialog(e,n,i({},t,{postConfirmCallback:a})):this.$q.resolve(this.dialogService.open(e,i({},t,{postConfirmCallback:a}))),this.openResultPromise.then(function(e){s(teamspace.services.ExtendedContainerState.Open),e.closePromise.then(function(){s(teamspace.services.ExtendedContainerState.Closed)})}),this.openResultPromise},e.prototype.closeDialog=function(e){this.dialogService.close(e)},e}();t.ExternalDialogHandler=o},2467:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(37),r=n(2468),o=n(85);t.isTearDownDueToFailure=function(e){var t=e.reason;return["crashed","failed-to-load","failed-to-load-chunk","failed-to-navigate","core-init-failed","no-skype-id"].some(function(e){return e===t})};var a=function(){function e(e,t,n,a,s,c,l,d,u,h){var p=this;this.params=e,this.experienceContainerFactory=t,this.loggingService=n,this.serviceWrapper=a,this.cdlCommunicator=s,this.onTearDownCallback=c,this.constants=l,this.$window=d,this.logger=u,this.settingsService=h,this.onTearDown=function(e,t){p._isReady=!1,p.tearDownListeners(),p.shellCommWrapper.tearDown(),p.stopCoreInitializedTimer(),p.onTearDownCallback(p,{data:t,reason:e}),p.experienceContainer.tearDown()},this.onCrashed=function(e){return p.onTearDown("crashed",e&&{errorDescription:e.crashType})},this.onFailedToLoad=function(e){return p.onTearDown("failed-to-load",e&&{errorDescription:e.errorDescription,statusCode:e.errorCode})},this.onFailedToLoadChunk=function(e){return p.onTearDown("failed-to-load-chunk",e&&{errorDescription:e.payload&&e.payload.errorDescription})},this.onFailedToNavigate=function(e){return p.onTearDown("failed-to-navigate",e&&{statusCode:e.httpResponseCode})},this.onReloaded=function(){return p.onTearDown("reloaded")},this.onCdlRequest=function(e){p.cdlCommunicator?e?(p.experienceContainer&&(e.dataLayer.rendererId=p.experienceContainer.elementId),p.cdlCommunicator.sendDataLayerRequest(e,p.experienceContainer.postMessage)):p.logger.error("Error in processing data layer request: Data layer request is undefined."):p.logger.error("Error in processing data layer request: Cdl communicator is unavailable.")},this.startCoreInitializedTimer=function(e){if(!e)return function(){};var t=p.constants.experienceContainers.timers.coreInitializedTimeout,n=p.$window.setTimeout(function(){p.onTearDown("core-not-initialized")},t);return function(){p.$window.clearTimeout(n)}},this.onCoreInitialized=function(){p.logger.info("Experience Container Core Initialized");var e=p.logger.service.findScenario(p.constants.experienceContainers.scenarios.init)||p.logger.service.findScenario(p.constants.experienceContainers.scenarios.retryInit),t=i.ChildWindowEventRequest.CoreInitialized;e?e.stop({reason:t}):p.logger.service.newScenario(p.constants.experienceContainers.scenarios.coreInitializedMiss).stop(),p.loggingService.setContext("ecState",t),p.stopCoreInitializedTimer(),p._isReady=!0,p.onReadyCallback?p.onReadyCallback():p.logger.error("onReady callback is not registered to the container entry")},this.onCoreInitializationFailed=function(e){p.onTearDown("core-init-failed",e&&{errorDescription:e&&e.errorDescription})},this._isReady=!1;var g=t.create(e);if(this.experienceContainer=g,!this.hasInvalidUserId(e)){this.setupListeners(),this.outerWrap=o.htmlFactory.createDiv("ExperienceContainerWrap-"+g.elementId),this.shellCommWrapper=new r.ShellCommWrapper(g,n,a,h,l),this.outerWrap.setAttribute("class","hidden");var v=n.findScenario(l.experienceContainers.scenarios.init);this.stopCoreInitializedTimer=this.startCoreInitializedTimer(v),g.appendTo(this.outerWrap).then(function(){var e=l.experienceContainers.step.constructContainerEntry;v&&v.mark(e),n.setContext("ecState",e)}).catch(function(e){u.error("Failed to append experience container "+g.elementId+" to wrapper: "+e);var t=e&&e.reason||l.experienceContainers.reason.constructContainerEntryFailed;v&&v.fail({reason:t,errorCode:e&&e.errorCode}),n.setContext("ecState",t)})}}return Object.defineProperty(e.prototype,"isReady",{get:function(){return this._isReady},enumerable:!0,configurable:!0}),e.prototype.onReady=function(e){this.onReadyCallback=e},e.prototype.collectLogs=function(){var e=this;return new Promise(function(t,n){var r=e.constants.timeInMiliseconds.second,o=i.ChildWindowEventRequest.GetLogs,a={eventId:o},s=0,c=function(n){e.experienceContainer.removeEventListener(o,c),e.$window.clearTimeout(s),t(n&&n.logs||[])};s=e.$window.setTimeout(function(){var t="Request to gather logs from experience container timed out after "+r+" milli seconds.";e.logger.error(t),e.experienceContainer.removeEventListener(o,c),n(t)},r),e.experienceContainer.addEventListener(o,c),e.experienceContainer.postMessage(a)})},e.prototype.collectLeaks=function(){var e=this;return new Promise(function(t,n){var r=15*e.constants.timeInMiliseconds.second,o=i.ChildWindowEventRequest.GetLeaks,a=0,s=function(n){e.experienceContainer.removeEventListener(o,s),e.$window.clearTimeout(a),t(n&&n.leaks||{})};a=e.$window.setTimeout(function(){var t="Request to gather leaks from experience container timed out after "+r+" milliseconds.";e.logger.error(t),e.experienceContainer.removeEventListener(o,s),n(t)},r),e.experienceContainer.addEventListener(o,s),e.experienceContainer.postMessage({eventId:o})})},e.prototype.getWindowEntityTypeStats=function(){var e=this;return new Promise(function(t,n){var r=i.ChildWindowEventRequest.GetWindowEntityTypeStats,o=e.constants.timeInMiliseconds.second,a=0,s=function(n){return e.experienceContainer.removeEventListener(r,s),e.$window.clearTimeout(a),t(n&&n.windowEntityTypeStats||{})};a=e.$window.setTimeout(function(){var t="Request for getWindowEntityTypeStats timed out after "+o+" milliseconds.";e.logger.error(t),e.experienceContainer.removeEventListener(r,s),n(t)},o),e.experienceContainer.addEventListener(r,s),e.experienceContainer.postMessage({eventId:r})})},e.prototype.shouldShowChatNotification=function(e){var t=this;return new Promise(function(n,r){var o=t.logger.service.newScenario(t.constants.containerEntry.scenarios.shouldShowChatNotification),a={shouldShowChatNotification:!0,windowId:void 0};if(!e)return t.logger.warn("shouldShowChatNotification called with falsy convId "+e),n(a);try{var s=t.constants.timeInMiliseconds.second,c=i.ChildWindowEventRequest.ShouldShowChatNotification,l={eventId:c,payload:{convId:e}},d=0,u=function(e){if(t.experienceContainer.removeEventListener(c,u),t.$window.clearTimeout(d),e&&e.hasOwnProperty("shouldShowChatNotification"))return o.stop(),n(e);t.logger.error("Response for shouldShowChatNotification is malformed "+JSON.stringify(e)),o.fail({reason:"invalidResponse"}),n(a)};d=t.$window.setTimeout(function(){var e="Request for shouldShowChatNotification timed out after "+s+" milli seconds.";t.logger.error(e),t.experienceContainer.removeEventListener(c,u),o.cancel(),n({shouldShowChatNotification:!0,windowId:void 0})},s),t.experienceContainer.addEventListener(c,u),t.logger.info("shouldShowChatNotification called with "+e),t.experienceContainer.postMessage(l)}catch(e){var h=t.getErrorString(e);o.fail({reason:"exception",errorMessage:h,errorCode:e&&e.errorCode,errorReason:e&&e.reason}),t.logger.error("shouldShowChatNotification failed with "+h),n(a)}})},e.prototype.hasInvalidUserId=function(e){var t=this,n=!(e&&e.settings&&e.settings.hostSettings&&e.settings.hostSettings.bootstrapData&&e.settings.hostSettings.bootstrapData.userId&&"8:undefined"!==e.settings.hostSettings.bootstrapData.userId);return n&&setTimeout(function(){return t.onTearDownCallback(t,{reason:"no-skype-id"})},0),n},e.prototype.getErrorString=function(e){var t=this.settingsService.getRing();return t&&"ring0"===t.id?JSON.stringify(e):void 0},e.prototype.setupListeners=function(){this.experienceContainer.addEventListener("crashed",this.onCrashed),this.experienceContainer.addEventListener("failed-to-load",this.onFailedToLoad),this.experienceContainer.addEventListener("failed-to-load-chunk",this.onFailedToLoadChunk),this.experienceContainer.addEventListener("failed-to-navigate",this.onFailedToNavigate),this.experienceContainer.addEventListener(i.ChildWindowEventRequest.WindowUnloaded,this.onReloaded),this.experienceContainer.addEventListener(i.ChildWindowEventRequest.CentralDataLayerRequest,this.onCdlRequest),this.experienceContainer.addEventListener(i.ChildWindowEventRequest.CoreInitialized,this.onCoreInitialized),this.experienceContainer.addEventListener(i.ChildWindowEventRequest.CoreInitializationFailed,this.onCoreInitializationFailed)},e.prototype.tearDownListeners=function(){this.experienceContainer.removeEventListener("crashed",this.onCrashed),this.experienceContainer.removeEventListener("failed-to-load",this.onFailedToLoad),this.experienceContainer.removeEventListener("failed-to-load-chunk",this.onFailedToLoadChunk),this.experienceContainer.removeEventListener("failed-to-navigate",this.onFailedToNavigate),this.experienceContainer.removeEventListener(i.ChildWindowEventRequest.WindowUnloaded,this.onReloaded),this.experienceContainer.removeEventListener(i.ChildWindowEventRequest.CentralDataLayerRequest,this.onCdlRequest),this.experienceContainer.removeEventListener(i.ChildWindowEventRequest.CoreInitialized,this.onCoreInitialized),this.experienceContainer.removeEventListener(i.ChildWindowEventRequest.CoreInitializationFailed,this.onCoreInitializationFailed)},e}();t.ContainerEntry=a},2468:function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++){t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=n(37),o=teamspace.services.UtilityServiceStatics.safeJsonStringify,a=teamspace.services.UtilityServiceStatics.parseJwt,s=function(){function e(e,t,n,i,o){var a=this;this.experienceContainer=e,this.serviceWrapper=n,this.settingsService=i,this.constants=o,this.messageHandler=function(e){var t=function(e){return a.experienceContainer.postMessage(e)};switch(e.eventId){case r.ChildWindowEventRequest.AadGetToken:a.settingsService.valueAsBoolean(a.constants.settings.names.returnTokenWithExpiration)?a.handleAadGetTokenObject(e,t):a.handleAadGetToken(e,t);break;case r.ChildWindowEventRequest.AadGetCurrentUser:a.handleAadGetCurrentUser(e,t);break;case r.ChildWindowEventRequest.GetStateData:a.handleGetStateData(e,t);break;case r.ChildWindowEventRequest.RequestShellToOpen:a.handleRequestShellToOpen(e,t);break;case r.ChildWindowEventRequest.UpdateWindowState:a.handleUpdateWindowState(e);break;case r.ChildWindowEventRequest.ScreenSharingControlMessage:a.handleScreenSharingControlMessage(e);break;case r.ChildWindowEventRequest.GetAggregatedSettings:a.handleGetAggregatedSettings(e,t);break;case r.ChildWindowEventRequest.CommandEvent:a.handleCommandEvent(e,t);break;case r.ChildWindowEventRequest.TriggerAutoBrb:a.handleAutoBrb(e);break;case r.ChildWindowEventRequest.WindowCrashed:case"windowErrored":a.handleWindowErrored(e);break;case r.ChildWindowEventRequest.UnhandledShortcut:a.handleUnhandledShortcut(e);break;case r.ChildWindowEventRequest.UnhandledMouseEvent:a.handleUnhandledMouseEvent(e)}},e.addEventListener("message",this.messageHandler),this.logger=t.newLogger(o.experienceContainers.log.prefix+"ShellCommWrapper")}return e.prototype.tearDown=function(){this.experienceContainer.removeEventListener("message",this.messageHandler)},e.prototype.createScenarioForAuth=function(e){var t=this.logger.service.findScenario(this.constants.experienceContainers.scenarios.ipcMessageListener);!t&&this.settingsService.valueFor(this.constants.settings.names.enableIPCMessageScenarioLogInShellCommV2)&&(t=this.logger.service.newScenario(this.constants.experienceContainers.scenarios.ipcMessageListener)),this.logger.info("message recieved eventId: '["+e.eventId+"], correaltionId: ["+e.correlationId+"]', payload:["+e.payload+"]"),t&&t.appendEventData({correlationId:e.correlationId,payload:o(e.payload),eventId:e.eventId})},e.prototype.handleAutoBrb=function(e){var t=e.payload;t&&t.title?this.serviceWrapper.triggerAutoBrb(t.title):this.logger.warn("handleAutoBrb called without valid payload "+o(t))},e.prototype.handleCommandEvent=function(e,t){var n=e.payload;if(n&&n.entityCommand&&n.commandEvent){var i=n.entityCommand,o=n.commandEvent,a=n.isCommandTargetedToMainWindow,s=n.contentExistsAndHasChanged,c=n.errorInfo;if(i.entity&&i.command)return this.logger.info("CommandEvent, entityCommand: "+JSON.stringify(i)),this.logger.info("CommandEvent, commandEvent:  "+o),this.logger.info("CommandEvent, event data: "+JSON.stringify({contentExistsAndHasChanged:s,errorInfo:c,isCommandTargetedToMainWindow:a})),o===r.CommandEvent.NotHandled?this.serviceWrapper.navigateMainWindowWithEntityCommand(i,t):a?this.handleCommandTargetedToMainWindow(n):void 0;this.logger.warn("handleCommandEvent Called without a valid payload command, payload: "+JSON.stringify(n))}else this.logger.warn("handleCommandEvent Called without a valid payload: "+JSON.stringify(n))},e.prototype.handleCommandTargetedToMainWindow=function(e){var t=e.entityCommand,n=e.commandEvent,i=e.contentExistsAndHasChanged;n===r.CommandEvent.WindowUpdated?this.serviceWrapper.navigateHybridContentRoute(t):n!==r.CommandEvent.UnmountStarted&&n!==r.CommandEvent.Rendered||this.serviceWrapper.onHybridContentReadyToRender(t),this.serviceWrapper.sendHybridViewportRenderingEvents(n,t,!!i)},e.prototype.handleGetAggregatedSettings=function(e,t){var n=this;this.serviceWrapper.getAggregatedSettings().then(function(t){return n.buildResponse(e,{data:t})}).then(t).catch(function(e){return n.logger.error("Failed to handle getAggregatedSettings",e)})},e.prototype.handleAadGetToken=function(e,t){var n=this;this.createScenarioForAuth(e),this.serviceWrapper.getAadToken(e.payload.resource,e.payload.claim?e.payload.claim:void 0,e.payload&&e.payload.timeout).then(function(t){return n.buildResponse(e,{token:t})}).then(t).catch(function(i){n.logger.error("Failed to handle AAD token",i),t(n.buildErrorResponse(e,i))})},e.prototype.handleAadGetTokenObject=function(e,t){var n=this;this.createScenarioForAuth(e);var i=e.payload,r=i.resource,o=i.claim,s=i.timeout,c=i.silent,l=i.forceTokenRenew,d=e.correlationId;this.serviceWrapper.getAadTokenObject({resource:r,claim:o,timeout:s,silent:c,forceTokenRenew:l,correlationId:d}).then(function(t){if(t&&t.token)return n.buildResponse(e,t);if("string"==typeof t&&a(t))return n.buildResponse(e,{token:t});var i="string"==typeof t&&t.indexOf("[auth]")>-1?t:"unknown error";throw new Error("Received invalid token. message ='["+typeof t+"]["+i+"]' ")}).then(t).catch(function(i){n.logger.error("Failed to handle AAD token",i),t(n.buildErrorResponse(e,i))})},e.prototype.handleAadGetCurrentUser=function(e,t){var n=this;this.createScenarioForAuth(e),this.serviceWrapper.getAuthUser(e.payload&&e.payload.timeout).then(function(t){return n.buildResponse(e,{authUser:t})}).then(t).catch(function(i){n.logger.error("Failed to handle AadGetCurrentUser",i),t(n.buildErrorResponse(e,i))})},e.prototype.handleGetStateData=function(e,t){var n=this;this.createScenarioForAuth(e);var i;switch(e.payload.requestType){case"skypeToken":i=this.serviceWrapper.getSkypeToken(e.payload&&e.payload.timeout).then(function(e){return{skypeTokenData:e}});break;case"hostSettings":i=Promise.resolve({hostSettings:this.serviceWrapper.getHostSettings()})}i.then(function(t){return n.buildResponse(e,t)}).then(t).catch(function(i){n.logger.error("Failed to handle GetStateData",i),t(n.buildErrorResponse(e,i))})},e.prototype.handleRequestShellToOpen=function(e,t){var n=this;if(e){var i=void 0,r=e.payload.openType,o=e.payload.openHandler,a=e.payload.handlerParams;if(r&&o)switch(r){case teamspace.services.OpenType.OpenOnMainRenderer:i=Promise.resolve({opened:this.serviceWrapper.navigateMainWindow(o,a)})}i.then(function(t){return n.buildResponse(e,t)}).then(t).catch(function(e){return n.logger.error("Failed to handle RequestShellToOpen",e)})}},e.prototype.handleScreenSharingControlMessage=function(e){e&&e.payload&&this.serviceWrapper.sendScreenSharingControlMessage(e.payload)},e.prototype.handleUpdateWindowState=function(e){if(e&&e.payload&&e.payload.childSettings&&e.payload.childSettings.appState){var t=e.payload.childSettings.appState;this.serviceWrapper.handleApplicationStateChange(t)}},e.prototype.handleUnhandledShortcut=function(e){this.serviceWrapper.handleUnhandledShortcut(e)},e.prototype.handleWindowErrored=function(e){var t=this,n=e.payload||{},i=n.errorMsg;if(n.showOops){var r=n.logs&&Array.isArray(n.logs)&&n.logs.length>0,o=r?"\nLogs emitted for a child window error:\n":"";this.logger.warn("Child window has hit an unrecovered errored state: errorMsg="+i+", errorCode="+n.errorCode+"."+o),n.errorStack&&this.logger.warn("Error Stack: "+n.errorStack),r&&n.logs.forEach(function(e){t.logger.warn(e.timeStamp+" "+e.levelName+" - "+e.message)})}},e.prototype.handleUnhandledMouseEvent=function(e){e.payload&&e.payload.type&&this.serviceWrapper.dispatchEventToMainWindow(e.payload.type)},e.prototype.buildResponse=function(e,t){var n=this.logger.service.findScenario(this.constants.experienceContainers.scenarios.ipcMessageListener);return n&&n.stop({"EventInfo.CorrelationId":e.correlationId}),this.logger.info("buildResponse for eventId:'["+e.eventId+"]', correlationId:'["+e.correlationId+"]'"),i({},e,{payload:t||{}})},e.prototype.buildErrorResponse=function(e,t){var n=this.logger.service.findScenario(this.constants.experienceContainers.scenarios.ipcMessageListener),r=this.getError(t),a="string"==typeof r?r:r.message?r.message:o(r),s=e.correlationId,c=e.eventId;return n&&n.fail({"EventInfo.CorrelationId":s,EcMessageListenerErrorMessage:a,eventId:c}),this.logger.info("buildErrorResponse for eventId:'["+c+"]', correlationId:'["+s+"]'"),i({},e,{error:r})},e.prototype.getError=function(e){return e?"string"==typeof e?e:e.error?e.error:e.message?e.message:"No message from error object":"Error not present"},e}();t.ShellCommWrapper=s},2469:function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++){t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e}).apply(this,arguments)},r=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,s)}c((i=i.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){function n(e){return function(t){return i([e,t])}}function i(n){if(r)throw new TypeError("Generator is already executing.");for(;c;)try{if(r=1,o&&(a=2&n[0]?o.return:n[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,o=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(a=c.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){c.label=n[1];break}if(6===n[0]&&c.label<a[1]){c.label=a[1],a=n;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(n);break}a[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],o=0}finally{r=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var r,o,a,s,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(t,"__esModule",{value:!0});var a,s=n(37),c=n(2470),l=n(2471);!function(e){e.IGNORED="retry_ignored",e.CANCELED="retry_canceled",e.FAILED="retry_failed"}(a=t.RETRY_FAILURES||(t.RETRY_FAILURES={}));var d=function(){function e(e,t,n,r,o){var a=this;this.constants=e,this.loggingService=t,this.appStateService=n,this.eventingService=r,this.retries=0,this.lastRetriedTimestamp=0,this.isRetrying=!1,this._retryState=s.RetryState.NotRetried,this.retryStrategy=null,this.logger=null,this.resetInternal=function(){a.logger.info("Resetting the retry manager counters on tear down."),a.lastRetriedTimestamp=0,a.resetRetries(),a._retryState=s.RetryState.NotRetried},this.resetRetries=function(){a.logger.info("Resetting the retry count to 0."),a.retries=0},this.logger=t.newLogger(e.experienceContainers.log.prefix+"ExperienceContainerRetryManager");var d=o.valueFor(e.settings.names.experienceContainerRetryConfig),u=o.valueAsBoolean(e.settings.names.enableNetworkWaitOnNoSkypeIdRetry),h=d&&d.strategies&&d.strategies.linearNetworkErrorRetry;this.retryStrategy=l.getLinearNetworkErrorRetry(i({},h,{enableNetworkWaitOnNoSkypeIdRetry:u})),this.resetRetriesOnce=c.default(this.resetRetries)}return e.prototype.shouldRetry=function(e){return r(this,void 0,void 0,function(){var t,n,i,r,c,l,d,u;return o(this,function(o){switch(o.label){case 0:if(t=Date.now()-this.lastRetriedTimestamp,n=this.loggingService.newScenario(this.constants.experienceContainers.scenarios.retry),this.logger.info("New retry request. Reason: "+e.reason),this.isRetrying&&"nudge"===e.reason)return n.stop({reason:e.reason}),this.logger.info("Retrying due to a nudge request."),this.updateRetryCounters(),this.resetRetries(),this._retryState=s.RetryState.RetryTriggered,[2];if(this.isRetrying)throw n.stop({reason:a.IGNORED}),this.logger.info("Retry was ignored"),a.IGNORED;this.isRetrying=!0,i=0,r=this.retryStrategy.conditions,o.label=1;case 1:return i<r.length?(c=r[i],this._retryState="shouldRetryOnNetworkError"===c.name?s.RetryState.WaitingForNetwork:s.RetryState.WaitingForCondition,[4,c({event:e,timeElapsed:t,resetRetriesOnce:this.resetRetriesOnce,appStateService:this.appStateService,logger:this.logger,eventingService:this.eventingService,constants:this.constants,timeoutBetweenRetries:this.retryStrategy.timeoutBetweenRetries,recreateTimeout:this.retryStrategy.recreateTimeout,scenario:n,maxRecreateAttempts:this.retryStrategy.maxRecreateAttempts,retries:this.retries})]):[3,4];case 2:if(l=o.sent(),d=l.shouldRetry,u=l.resetRetryCountAfterRetry,d&&!this.isRetrying)throw n.stop({reason:a.CANCELED}),this.logger.info("Retry was canceled"),a.CANCELED;if(d&&this.isRetrying)return n.stop({reason:c.name}),this.logger.info("Retry succeeded. Retry condition: "+c.name),this.updateRetryCounters(),u&&this.resetRetries(),this._retryState=s.RetryState.RetryTriggered,[2];o.label=3;case 3:return i++,[3,1];case 4:throw n.fail({reason:a.FAILED}),this.isRetrying=!1,this.logger.error("Maximum retries hit. Not attempting to recreate the experience container."),this._retryState=s.RetryState.RetryFailed,a.FAILED}})})},e.prototype.reset=function(){this.resetInternal(),this.resetRetriesOnce=c.default(this.resetRetries)},Object.defineProperty(e.prototype,"recreateAttempts",{get:function(){return this.retries},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"retryState",{get:function(){return this._retryState},enumerable:!0,configurable:!0}),e.prototype.updateRetryCounters=function(){this.lastRetriedTimestamp=Date.now(),this.retries++,this.isRetrying=!1},e}();t.ExperienceContainerRetryManager=d},2470:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(210),r=1/0,o=1.7976931348623157e308,a=function(e){return e?(e=i.a(e))===r||e===-r?(e<0?-1:1)*o:e===e?e:0:0===e?e:0},s=function(e){var t=a(e),n=t%1;return t===t?n?t-n:t:0},c="Expected a function",l=function(e,t){var n;if("function"!=typeof t)throw new TypeError(c);return e=s(e),function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=void 0),n}};t.default=function(e){return l(2,e)}},2471:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2472);t.getLinearNetworkErrorRetry=function(e){var t=void 0===e?{}:e,n=t.timeoutBetweenRetries,r=t.enableNetworkWaitOnNoSkypeIdRetry;return{conditions:[i.shouldRetryOnReloadEvent,r?i.shouldRetryOnNoSkypeIdWaitForConnected:i.shouldRetryOnNoSkypeId,i.shouldRetryOnDormant,i.shouldRetryOnNetworkError,i.shouldRetryOnNavigateError,i.shouldRetryNotExceededAttempts],timeoutBetweenRetries:n||2e4,recreateTimeout:18e4,maxRecreateAttempts:3}}},2472:function(e,t,n){"use strict";function i(e){var n=this,i=e.logger,r=e.appStateService,o=e.eventingService,c=e.constants,l=e.timeoutBetweenRetries,d=e.scenario;return i.info("Are we connected? "+r.isConnected),new Promise(function(e){return a(n,void 0,void 0,function(){var n;return s(this,function(a){switch(a.label){case 0:return r.isConnected?[4,t.wait(l,i)]:[3,2];case 1:return a.sent(),e(),[2];case 2:return d.pause({reason:"no network"}),n=o.unsafeOn(c.events.appState.changed,function(){r.isConnected&&(d.resume(),i.info("App state updated. We are now connected."),n(),e())}),[2]}})})})}function r(e,t){return e>=t}function o(e,t){return Object.defineProperty(t,"name",{value:e})}var a=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,s)}c((i=i.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){function n(e){return function(t){return i([e,t])}}function i(n){if(r)throw new TypeError("Generator is already executing.");for(;c;)try{if(r=1,o&&(a=2&n[0]?o.return:n[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,o=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(a=c.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){c.label=n[1];break}if(6===n[0]&&c.label<a[1]){c.label=a[1],a=n;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(n);break}a[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],o=0}finally{r=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var r,o,a,s,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},c=this;Object.defineProperty(t,"__esModule",{value:!0}),t.wait=function(e,t){return t.info("Starting to wait for "+e+"ms."),new Promise(function(n){setTimeout(function(){t.info("Done waiting for "+e+"."),n()},e)})},t.shouldRetryOnReloadEvent=o("shouldRetryOnReloadEvent",function(e){var t=e.event,n=e.logger;return a(c,void 0,void 0,function(){return s(this,function(e){return"reloaded"===t.reason?(n.info("Attempting to recreate the experience container after unloading."),[2,{shouldRetry:!0,resetRetryCountAfterRetry:!0}]):[2,{shouldRetry:!1}]})})}),t.shouldRetryOnNoSkypeId=o("shouldRetryOnNoSkypeId",function(e){var n=e.event,i=e.logger,o=e.timeoutBetweenRetries,l=e.retries,d=e.maxRecreateAttempts;return a(c,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return r(l,d)||"no-skype-id"!==n.reason?[3,2]:[4,t.wait(o,i)];case 1:return e.sent(),[2,{shouldRetry:!0}];case 2:return[2,{shouldRetry:!1}]}})})}),t.shouldRetryOnNoSkypeIdWaitForConnected=o("shouldRetryOnNoSkypeIdWaitForConnected",function(e){return a(c,void 0,void 0,function(){var t,n,o;return s(this,function(a){switch(a.label){case 0:return t=e.event,n=e.retries,o=e.maxRecreateAttempts,r(n,o)||"no-skype-id"!==t.reason?[3,2]:[4,i(e)];case 1:return a.sent(),[2,{shouldRetry:!0}];case 2:return[2,{shouldRetry:!1}]}})})}),t.shouldRetryOnDormant=o("shouldRetryOnDormant",function(e){var t=e.timeElapsed,n=e.recreateTimeout,i=e.logger;return a(c,void 0,void 0,function(){return s(this,function(e){return t>n?(i.info("Attempting to recreate the experience container because the last attempt was made "+t+" ms ago, which is beyond the recreate limit time window: "+n+" ms."),[2,{shouldRetry:!0,resetRetryCountAfterRetry:!0}]):[2,{shouldRetry:!1}]})})}),t.shouldRetryOnNetworkError=o("shouldRetryOnNetworkError",function(e){return a(c,void 0,void 0,function(){var t,n,o,a,c,l;return s(this,function(s){switch(s.label){case 0:return t=e.event,n=e.logger,o=e.resetRetriesOnce,a=e.retries,c=e.maxRecreateAttempts,"failed-to-load"!==t.reason&&"failed-to-load-chunk"!==t.reason?[3,2]:(o(),r(a,c)?[3,2]:(l=t.data&&t.data.statusCode,n.info(t.reason+" - recreating experience container. Status code: "+l),[4,i(e)]));case 1:return s.sent(),[2,{shouldRetry:!0}];case 2:return[2,{shouldRetry:!1}]}})})}),t.shouldRetryOnNavigateError=o("shouldRetryOnNavigateError",function(e){return a(c,void 0,void 0,function(){var n,i,o,a,c,l,d;return s(this,function(s){switch(s.label){case 0:return n=e.event,i=e.logger,o=e.resetRetriesOnce,a=e.retries,c=e.timeoutBetweenRetries,l=e.maxRecreateAttempts,"failed-to-navigate"!==n.reason?[3,2]:(o(),r(a,l)?[3,2]:(d=n.data&&n.data.statusCode,i.info("failed-to-navigate - recreating experience container. Status code: "+d),[4,t.wait(c,i)]));case 1:return s.sent(),[2,{shouldRetry:!0}];case 2:return[2,{shouldRetry:!1}]}})})}),t.shouldRetryNotExceededAttempts=o("shouldRetryNotExceededAttempts",function(e){var n=e.logger,i=e.retries,o=e.timeoutBetweenRetries,l=e.maxRecreateAttempts;return a(c,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return r(i,l)?[3,2]:(n.info("Attempting to recreate the experience container. Attempt #"+i+"."),[4,t.wait(o,n)]);case 1:return e.sent(),[2,{shouldRetry:!0}];case 2:return[2,{shouldRetry:!1}]}})})})},2473:function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(t,"__esModule",{value:!0});var r=n(37),o=n(2474),a=function(e){function t(t,n,i,r,o){var a=e.call(this,t)||this;return a.experienceContainerManager=r,a.experienceContainerFeatureService=o,a.isHidden=!0,a.destroy=function(){a.resizeSampleElement=void 0,a.isHidden=!0,a.logger.log("Setting hidden class on hybrid element"),a.experienceUiWrap.setAttribute("class","hidden"),a.resizeObserver&&a.resizeObserver.disconnect()},a.logger=i.newLogger(""+n.experienceContainers.log.prefix+a.mtmaTelemetryIdentifier()),a.initializeOnAppLaunchAndReinit("constructor"),a}return i(t,e),t.$inject=["orchestrationService","constants","loggingService","experienceContainerManager","experienceContainerFeatureService"],Object.defineProperty(t.prototype,"experienceContainer",{get:function(){return this.experienceContainerManager.get()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"experienceUiWrap",{get:function(){return this.experienceContainerManager.getUiHandle()},enumerable:!0,configurable:!0}),t.prototype.initializeOnAppLaunchAndReinit=function(e){var t=this;this.logger.log("initializeOnAppLaunchAndReinit, reason: "+e),this.experienceContainerFeatureService.isHybridAppExperienceContainerEnabled()&&(this.resizeObserver=new ResizeObserver(function(e){if(!t.isHidden){var n=e[0].contentRect;t.resizeUtil.setSize(n);var i=t.resizeUtil.getElementStyle(performance.now());$(t.experienceUiWrap).css(i)}}),this.resizeUtil=new o.HybridAppResizeUtil,this.experienceContainerManager.setOnTearDownCallback(this.destroy))},t.prototype.mtmaTelemetryIdentifier=function(){return"HybridAppService"},t.prototype.cleanupOnAppTeardown=function(e){this.logger.log("cleanupOnAppTeardown, reason: "+e),this.resizeUtil=void 0,this.resizeSampleElement=void 0,this.isHidden=!0,this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=void 0)},Object.defineProperty(t.prototype,"isReady",{get:function(){return this.experienceContainerManager.isReady},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"retryState",{get:function(){return this.experienceContainerManager.retryState},enumerable:!0,configurable:!0}),t.prototype.setOnReadyCallback=function(e){return this.experienceContainerManager.setOnReadyCallback(e)},t.prototype.collectLogs=function(){return this.experienceContainerManager.collectLogs()},t.prototype.collectLeaks=function(){return this.experienceContainerManager.collectLeaks()},t.prototype.getWindowEntityTypeStats=function(){return this.experienceContainerManager.getWindowEntityTypeStats()},t.prototype.refreshHostSettings=function(){this.sendMessage({hostSettings:this.experienceContainerManager.getHostSettings()})},t.prototype.setSettings=function(e){this.sendMessage(e)},t.prototype.setAggregatedSettings=function(e){if(this.experienceContainer){var t={eventId:r.ChildWindowEventRequest.SetAggregatedSettings,payload:e};this.experienceContainer.postMessage(t)}},t.prototype.setTheme=function(e){this.sendMessage({hostSettings:{theme:e}})},t.prototype.setAppState=function(e,t){if(this.sendMessage({hostSettings:{appState:e}}),this.experienceContainer){var n={eventId:r.ChildWindowEventRequest.AppStateSyncMessage,payload:{appState:e,isMachineLocked:t}};this.experienceContainer.postMessage(n)}},t.prototype.setLocale=function(e){this.sendMessage({hostSettings:{localeCode:e}})},t.prototype.nudge=function(){this.experienceContainerManager.nudge()},t.prototype.sendCommand=function(e){var t=e.entity,n=e.entityOptions,i=e.command,o={eventId:r.ChildWindowEventRequest.ExecuteEntityCommand,payload:{entity:t,entityOptions:n,command:i}};return this.experienceContainer.postMessage(o)},t.prototype.renderOnElement=function(e,t){var n=this;if(!this.isRenderingOverElementsEnabled())throw teamspace.services.commanding.EntityCommandErrorCode.ExperienceContainerNotEnabled;this.isHidden=!1,t&&(this.logger.log("Setting behind overlay class on hybrid element"),this.experienceUiWrap.setAttribute("class","behind overlay")),this.experienceContainer&&this.experienceContainer.focus(),this.setupResizeObserverOnElement(e),t||this.experienceContainer.setTimeout().then(function(){n.isHidden?n.logger.log("renderOnElement visible class cancelled because the element is hidden"):(n.logger.log("Setting visible class on hybrid element"),n.experienceUiWrap.setAttribute("class","visible overlay"))})},t.prototype.setupResizeObserverOnElement=function(e){this.resizeSampleElement&&this.resizeSampleElement===e||(this.resizeSampleElement&&this.resizeObserver&&this.resizeObserver.disconnect(),this.resizeSampleElement=e,e&&(this.experienceUiWrap.style.width=e.clientWidth+"px",this.experienceUiWrap.style.height=e.clientHeight+"px",this.resizeObserver&&this.resizeObserver.observe(e)))},t.prototype.shouldShowChatNotification=function(e){return this.experienceContainerManager.shouldShowChatNotification(e)},t.prototype.isRenderingOverElementsEnabled=function(){return this.experienceContainer&&this.experienceContainerFeatureService.isHybridAppExperienceContainerEnabled()},t.prototype.sendMessage=function(e){if(this.experienceContainer){var t={eventId:r.ChildWindowEventRequest.UpdateWindowState,payload:e};this.experienceContainer.postMessage(t)}},t}(teamspace.services.MTMABase);t.HybridAppService=a,angular.module("teamspace.hybridAppServiceLazy",["teamspace.constants","teamspace.loggingService","teamspace.orchestrationService","teamspace.experienceContainerManager","teamspace.experienceContainerFeatureService"]).service("hybridAppServiceLazy",a)},2474:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this.lastResizeTimestamp=0,this.RESIZE_INTERVAL=16.67}return e.prototype.setSize=function(e){this.height=e.height,this.width=e.width},e.prototype.getElementStyle=function(e){var t=this.getSize(),n=t.width,i=t.height,r=this.lastSetHeight!==n||this.lastSetWidth!==i,o=e-this.lastResizeTimestamp,a="transform 16.67ms ease-in-out, width 16.67ms ease-in-out, height 16.67ms ease-in-out";return r?o>=this.RESIZE_INTERVAL?(this.lastSetHeight=i,this.lastSetWidth=n,this.lastResizeTimestamp=e,{transition:a,transform:"none",width:[n,"px"].join(""),height:[i,"px"].join("")}):{transition:a,transform:"scale("+n/this.lastSetWidth+","+i/this.lastSetHeight+")"}:{transition:a,transform:"none"}},e.prototype.getSize=function(){return{width:this.width,height:this.height}},e}();t.HybridAppResizeUtil=i},293:function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(t,"__esModule",{value:!0});var r=n(37),o=n(2462),a=3e4,s=[r.CommandEvent.Close,r.CommandEvent.CommandReportingTimedOut,r.CommandEvent.Failure],c=[r.CommandEvent.Incomplete],l=[r.CommandEvent.Blanked,r.CommandEvent.Flushed,r.CommandEvent.Focus,r.CommandEvent.NotHandled,r.CommandEvent.Rendered],d=l.concat(c),u=function(e){function t(t,n,i,o,u){var h=e.call(this,t)||this;return h.logger=t,h.elementId=n,h.params=i,h.constants=o,h.$window=u,h.postMessage=function(e){return new Promise(function(t,n){try{h._postMessage(e)}catch(e){h.logger.error("postMessage() failed - elementId={0}: {1}",h.elementId,e),n({error:e,reason:teamspace.services.commanding.EntityCommandErrorCode.SendCommandException})}if(e.payload&&e.payload.command&&e.payload.command.correlation&&e.payload.command.correlation.id){var i=!1,o=!1;h.logger.log("experienceContainer entity command sent: "+JSON.stringify(e.payload));var u=h.logger.service.findScenarioByNameAndId(h.constants.multiWindow.scenario.enqueueEntityCommand,e.payload.command.correlation.id);if(u){var p=teamspace.services.commanding.EntityCommandStep.CommandSent;u.mark(p),u.appendEventData({previousStep:p})}var g=function(a){var u=a.commandEvent,p=a.contentExistsAndHasChanged,v=a.entityCommand,m=a.errorInfo,f=v.command.correlation.id;if(e.payload.command.correlation.id===f)if(f){h.logger.log("CommandEvent Received, correlationId: "+f+", commandEvent: "+u);var y=h.logger.service.findScenarioByNameAndId(h.constants.multiWindow.scenario.enqueueEntityCommand,f);y&&(y.mark(u),y.appendEventData({previousStep:u}));var C=u===r.CommandEvent.RenderStarted&&!1===p;if(o||!d.includes(u)&&!C||(h.logger.log("Resolving enqueueEntityCommand promise, correlationId: "+f+", reason: "+(C?"AlreadyRendered":u)),t(),o=!0),i||!l.includes(u)&&!C||(h.logger.log("Stopping enqueueEntityCommand scenario, correlationId: "+f+", reason: "+u),y&&y.stop({reason:C?"AlreadyRendered":u}),i=!0),!i&&c.includes(u)&&(h.logger.log("Cancelling/Abandoning enqueueEntityCommand scenario, correlationId: "+f+", reason: "+u),y&&y.cancel({reason:u}),i=!0),s.includes(u)){var S=h.getErrorCode(m);h.logger.error("Failing enqueueEntityCommand promise, correlationId: "+f+", reason: "+u+", errorCode: "+S),n(u===r.CommandEvent.Failure?S:u),h.removeEventListener(r.ChildWindowEventRequest.CommandEvent,g)}}else h.logger.error("CommandEvent Received without a valid correlation id, entityCommand: "+v)};h.addEventListener(r.ChildWindowEventRequest.CommandEvent,g),h.$window.setTimeout(function(){h.removeEventListener(r.ChildWindowEventRequest.CommandEvent,g),n(teamspace.services.commanding.EntityCommandErrorCode.TimeoutWaitingForCompletion)},a)}else t()})},h.element=h.createElement(i.url),h}return i(t,e),t.prototype.appendTo=function(e){if(this.element)try{return e.appendChild(this.element),Promise.resolve()}catch(e){return this.logger.error("appendChild() failed - elementId={0}: {1}",this.elementId,e),Promise.reject(this.constants.experienceContainers.reason.ecAppendToError)}return Promise.reject(this.constants.experienceContainers.reason.ecAppendToNoElement)},t.prototype.focus=function(){this.element&&this.element.focus()},t.prototype._handleExperienceContainerEvent=function(e){if(e){if(e.requestRendererId=this.elementId,this.publish("message",e),e.eventId){if(e.eventId===r.ChildWindowEventRequest.ExperienceStarted){var t=e.payload&&e.payload.message,n=e.payload&&e.payload.errorCode;this.logger.info("ExperienceStarted:"+t+" code:"+n),n&&-1==n&&this.publish("failed-to-load-chunk",e)}this.publish(e.eventId,e.payload)}}else this.logger.error("Invalid experience container event - received no args.")},t.prototype.getErrorCode=function(e){switch(e){case"ChunkLoadTimedOut":return teamspace.services.commanding.EntityCommandErrorCode.ChunkLoadTimedOut;case"CSSLoadError":return teamspace.services.commanding.EntityCommandErrorCode.CSSLoadError;case"LazyLoadError":return teamspace.services.commanding.EntityCommandErrorCode.LazyLoadError;case"RenderingError":return teamspace.services.commanding.EntityCommandErrorCode.RenderingError;case"ScriptCodeError":return teamspace.services.commanding.EntityCommandErrorCode.ScriptCodeError;case"ScriptEvalError":return teamspace.services.commanding.EntityCommandErrorCode.ScriptEvalError;case"ScriptLoadError":return teamspace.services.commanding.EntityCommandErrorCode.ScriptLoadError;case"WindowCacheFailedToUpdate":return teamspace.services.commanding.EntityCommandErrorCode.WindowCacheFailedToUpdate;default:return teamspace.services.commanding.EntityCommandErrorCode.UnknownCommandFailure}},t}(o.EventPublisher);t.ExperienceContainer=u},37:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RetryState=teamspace.services.RetryState,t.EntityCommandErrorCode=teamspace.services.commanding.EntityCommandErrorCode,t.CommandEvent=teamspace.services.commanding.CommandEvent,t.StaticTabId=teamspace.services.commanding.StaticTabId,t.ChildWindowEventRequest=teamspace.services.ChildWindowEventRequest},85:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.prototype.createDiv=function(e){return this.createElement("div",e)},e.prototype.createWebView=function(e){return this.createElement("webview",e)},e.prototype.createIframe=function(e){return this.createElement("iframe",e)},e.prototype.createElement=function(e,t){var n=document.createElement(e);return n.id=t,n},e}();t.htmlFactory=new i}},[2459]);